[TOC]

http是一个简单的请求-响应协议，它通常运行在TCP之上。它指定了客户端可能发送给服务器什么样的消息以及得到什么样的响应。请求和响应消息的头以ASCII码形式给出；而消息内容则具有一个类似MIME的格式。这个简单模型是早期Web成功的有功之臣，因为它使得开发和部署是那么的直截了当。

| 类别       | 内容           | 类别           | 内容                                    |
| ---------- | :------------- | :------------- | --------------------------------------- |
| **中文名** | 超文本传输协议 | **基础**       | 架构在tcp协议上                         |
| **英文名** | HTTP           | **适用浏览器** | 火狐，谷歌等                            |
| **工作层** | 应用层         | **作用**       | 规范www服务器与浏览器之间信息传递规规范 |

# 一、简介

[万维网](https://baike.baidu.com/item/万维网/215515)WWW（world wide web）发源于欧洲日内瓦量子物理实验室CERN，正是WWW技术的出现使得因特网得以超乎想象的速度迅猛发展。这项基于TCP/IP的技术在短短的十年时间内迅速成为已经发展了几十年的Internet上的规模最大的信息系统，它的成功归结于它的简单、实用。在WWW的背后有一系列的协议和标准支持它完成如此宏大的工作，这就是Web协议族，其中就包括HTTP超文本传输协议。

[![图1 HTTP](https://bkimg.cdn.bcebos.com/pic/bd3eb13533fa828b5a900e02f31f4134960a5aa4?x-bce-process=image/resize,m_lfit,w_220,h_220,limit_1)](https://baike.baidu.com/pic/http/243074/0/bd3eb13533fa828b5a900e02f31f4134960a5aa4?fr=lemma&ct=single)

在1990年，HTTP就成为WWW的支撑协议。当时由其创始人WWW之父蒂姆·贝纳斯·李（TimBerners—Lee）提出，随后WWW联盟（WWW Consortium）成立，组织了IETF（Internet Engineering Task Force）小组进一步完善和发布HTTP协议。 

HTTP是应用层协议，同其他应用层协议一样，是为了实现某一类具体应用的协议，并由某一运行在用户空间的应用程序来实现其功能。HTTP是一种协议规范，这种规范记录在文档上，为真正通过HTTP协议进行通信的HTTP的实现程序。

HTTP协议是基于C/S架构进行通信的，而HTTP协议的服务器端实现程序有httpd、nginx等，其客户端的实现程序主要是Web浏览器，例如Firefox、InternetExplorer、Google chrome、Safari、Opera等，此外，客户端的命令行工具还有elink、[curl](https://baike.baidu.com/item/curl)等。Web服务是基于TCP的，因此为了能够随时响应客户端的请求，Web服务器需要监听在80/TCP端口。这客户端浏览器和Web服务器之间就可以通过HTTP协议进行通信了。

#  二、发展阶段

* 0.9协议是适用于各种数据信息的简洁快速协议，但是远不能满足日益发展的各种应用的需要。0.9协议就是一个交换信息的无序协议，仅仅限于文字。由于无法进行内容的协商，在双发的握手和协议中，并有规定双发的内容是什么，也就是图片是无法显示和处理的。 
* 到了1.0协议阶段，也就是在1982年，TimBerners-Lee提出了HTTP/1.0。在此后的不断丰富和发展中，HTTP/1.0成为最重要的面向事务的应用层协议。该协议对每一次请求/响应建立并拆除一次连接。其特点是简单、易于管理，所以它符合了大家的需要，得到了广泛的应用。
* 在1.0协议中，双方规定了连接方式和连接类型，这已经极大扩展了HTTP的领域，但对于互联网最重要的速度和效率，并没有太多的考虑。毕竟，作为协议的制定者，当时也没有想到HTTP协议会有那么快的普及速度。关于HTTP1.1协议的具体内容可以参考RFC 2616。
* HTTP2.0的前世是HTTP1.0和HTTP1.1。虽然之前仅仅只有两个版本，但这两个版本所包含的协议规范之庞大，足以让任何一个有经验的工程师为之头疼。网络协议新版本并不会马上取代旧版本。实际上，1.0和1.1在之后很长的一段时间内一直并存，这是由于网络基础设施更新缓慢所决定的。 关于HTTP2.0协议的具体内容可以参考RFC 7540。

# 三、应用场景

HTTP诞生之初主要是应用于WEB端内容获取，那时候内容还不像现在这样丰富，排版也没那么精美，用户交互的场景几乎没有。对于这种简单的获取网页内容的场景，HTTP表现得还算不错。但随着互联网的发展和WEB2．0的诞生，更多的内容开始被展示（更多的图片文件），排版变得更精美（更多的CSS），更复杂的交互也被引入（更多的jS）。用户打开一个网站首页所加载的数据总量和请求的个数也在不断增加。

今天绝大部分的门户网站首页大小都会超过2M，请求数量可以多达100个。另一个广泛的应用是在移动互联网的客户端APP，不同性质的APP对HTTP的使用差异很大。对于电商类APP，加载首页的请求也可能多达10多个。对于微信这类IM，HTTP请求可能仅限于语音和图片文件的下载，请求出现的频率并不算高。

[![图2HTTP协议的网页](https://bkimg.cdn.bcebos.com/pic/8c1001e93901213f33bd9ec059e736d12f2e9524?x-bce-process=image/resize,m_lfit,w_220,h_220,limit_1)](https://baike.baidu.com/pic/http/243074/0/8c1001e93901213f33bd9ec059e736d12f2e9524?fr=lemma&ct=single)

# 四、工作原理

HTTP是基于客户/服务器模式，且面向连接的。典型的HTTP事务处理有如下的过程： 

1. 客户与服务器建立连接；
2. 客户向服务器提出请求；
3. 服务器接受请求，并根据请求返回相应的文件作为应答；
4. 客户与服务器关闭连接。

客户与服务器之间的HTTP连接是一种一次性连接，它限制每次连接只处理一个请求，当服务器返回本次请求的应答后便立即关闭连接，下次请求再重新建立连接。这种一次性连接主要考虑到WWW服务器面向的是Internet中成干上万个用户，且只能提供有限个连接，故服务器不会让一个连接处于等待状态，及时地释放连接可以大大提高服务器的执行效率。 

HTTP是一种无状态协议，即服务器不保留与客户交易时的任何状态。这就大大减轻了服务器记忆负担，从而保持较快的响应速度。HTTP是一种面向对象的协议。允许传送任意类型的数据对象。它通过数据类型和长度来标识所传送的数据内容和大小，并允许对数据进行压缩传送。当用户在一个[HTML](https://baike.baidu.com/item/HTML/97049)文档中定义了一个超文本链后，浏览器将通过TCP/IP协议与指定的服务器建立连接。 

从技术上讲是客户在一个特定的TCP端口（端口号一般为80）上打开一个套接字。如果服务器一直在这个周知的端口上倾听连接，则该连接便会建立起来。然后客户通过该连接发送一个包含请求方法的请求块。

HTTP规范定义了9种请求方法，每种请求方法规定了客户和服务器之间不同的信息交换方式，常用的请求方法是GET和POST。服务器将根据客户请求完成相应操作，并以应答块形式返回给客户，最后关闭连接

# 五、运作方式

在WWW中，“客户”与“服务器”是一个相对的概念，只存在于一个特定的连接期间，即在某个连接中的客户在另一个连接中可能作为服务器。基于HTTP协议的客户/服务器模式的信息交换过程，它分四个过程：建立连接、发送请求信息、发送响应信息、关闭连接。

HTTP协议是基于请求/响应[范式](https://baike.baidu.com/item/范式)的。一个客户机与[服务器](https://baike.baidu.com/item/服务器)建立连接后，发送一个请求给服务器，请求方式的格式为，统一资源标识符、协议版本号，后边是MIME信息包括请求修饰符、客户机信息和可能的内容。服务器接到请求后，给予相应的响应信息，其格式为一个状态行包括信息的协议版本号、一个成功或错误的代码，后边是[MIME](https://baike.baidu.com/item/MIME)信息包括服务器信息、实体信息和可能的内容。

[![图3 http运作方式的一种](https://bkimg.cdn.bcebos.com/pic/1b4c510fd9f9d72acd008769d42a2834349bbb5a?x-bce-process=image/resize,m_lfit,w_220,h_220,limit_1)](https://baike.baidu.com/pic/http/243074/0/5202e5f21f483157b07ec5bb?fr=lemma&ct=single)

其实简单说就是任何服务器除了包括HTML文件以外，还有一个HTTP驻留程序，用于响应用户请求。你的浏览器是HTTP客户，向服务器发送请求，当浏览器中输入了一个开始文件或点击了一个超级链接时，浏览器就向服务器发送了HTTP请求，此请求被送往由[IP地址](https://baike.baidu.com/item/IP地址)指定的URL。驻留程序接收到请求，在进行必要的操作后回送所要求的文件。在这一过程中，在网络上发送和接收的数据已经被分成一个或多个数据包（packet），每个数据包包括：要传送的数据；控制信息，即告诉网络怎样处理数据包。TCP/IP决定了每个数据包的格式。如果事先不告诉你，你可能不会知道信息被分成用于传输和再重新组合起来的许多小块。

许多HTTP通讯是由一个用户代理初始化的并且包括一个申请在源服务器上资源的请求。最简单的情况可能是在用户代理(UA)和源服务器(O)之间通过一个单独的连接来完成。

当一个或多个中介出现在请求/响应链中时，情况就变得复杂一些。中介有三种：代理(Proxy)、[网关](https://baike.baidu.com/item/网关)(Gateway)和通道(Tunnel)。一个代理根据URI的绝对格式来接受请求，重写全部或部分消息，通过URI的标识把已格式化过的请求发送到服务器。网关是一个接收代理，作为一些其它服务器的上层，并且如果必须的话，可以把请求翻译给下层的服务器协议。一个通道作为不改变消息的两个连接之间的中继点。当通讯需要通过一个中介(例如：防火墙等)或者是中介不能识别消息的内容时，通道经常被使用。

# 六、报文格式

HTTP报文由从客户机到服务器的请求和从服务器到客户机的响应构成。

**请求报文格式如下**：

**请求行 － 通用信息头 － 请求头 － 实体头 － 报文主体**

请求行以方法字段开始，后面分别是 URL 字段和 HTTP 协议版本字段，并以 CRLF 结尾。SP 是分隔符。除了在最后的 CRLF 序列中 CF 和 LF 是必需的之外，其他都可以不要。有关通用信息头，请求头和实体头方面的具体内容可以参照相关文件。

**应答报文格式如下：**

**状态行 － 通用信息头 － 响应头 － 实体头 － 报文主体**

# 七、状态码

状态码元由3位数字组成，表示请求是否被理解或被满足。原因分析是对原文的状态码作简短的描述，状态码用来支持自动操作，而原因分析用来供用户使用。客户机无需用来检查或显示语法。有关通用信息头，响应头和实体头方面的具体内容可以参照相关文件。

| 消息                    | 描述                                                         |
| ----------------------- | ------------------------------------------------------------ |
| 100 Continue            | 服务器仅接收到部分请求，但是一旦服务器并没有拒绝该请求，客户端应该继续发送其余的请求。 |
| 101 Switching Protocols | 服务器转换协议：服务器将遵从客户的请求转换到另外一种协议。   |

| 消息                              | 描述                                                         |
| --------------------------------- | ------------------------------------------------------------ |
| 200 OK                            | 请求成功（其后是对GET和POST请求的应答文档。）                |
| 201 Created                       | 请求被创建完成，同时新的资源被创建。                         |
| 202 Accepted                      | 供处理的请求已被接受，但是处理未完成。                       |
| 203 Non-authoritative Information | 文档已经正常地返回，但一些应答头可能不正确，因为使用的是文档的拷贝。 |
| 204 No Content                    | 没有新文档。浏览器应该继续显示原来的文档。如果用户定期地刷新页面，而Servlet可以确定用户文档足够新，这个状态代码是很有用的。 |
| 205 Reset Content                 | 没有新文档。但浏览器应该重置它所显示的内容。用来强制浏览器清除表单输入内容。 |
| 206 Partial Content               | 客户发送了一个带有Range头的GET请求，服务器完成了它。         |

| 消息                   | 描述                                                         |
| ---------------------- | ------------------------------------------------------------ |
| 300 Multiple Choices   | 多重选择。链接列表。用户可以选择某链接到达目的地。最多允许五个地址。 |
| 301 Moved Permanently  | 所请求的页面已经转移至新的url。                              |
| 302 Found              | 所请求的页面已经临时转移至新的url。                          |
| 303 See Other          | 所请求的页面可在别的url下被找到。                            |
| 304 Not Modified       | 未按预期修改文档。客户端有缓冲的文档并发出了一个条件性的请求（一般是提供If-Modified-Since头表示客户只想比指定日期更新的文档）。服务器告诉客户，原来缓冲的文档还可以继续使用。 |
| 305 Use Proxy          | 客户请求的文档应该通过Location头所指明的代理服务器提取。     |
| 306 *Unused*           | 此代码被用于前一版本。目前已不再使用，但是代码依然被保留。   |
| 307 Temporary Redirect | 被请求的页面已经临时移至新的url。                            |

| 消息                                | 描述                                                         |
| ----------------------------------- | ------------------------------------------------------------ |
| 400 Bad Request                     | 服务器未能理解请求。                                         |
| 401 Unauthorized                    | 被请求的页面需要用户名和密码。                               |
| 401.1                               | 登录失败。                                                   |
| 401.2                               | 服务器配置导致登录失败。                                     |
| 401.3                               | 由于 ACL 对资源的限制而未获得授权。                          |
| 401.4                               | 筛选器授权失败。                                             |
| 401.5                               | ISAPI/CGI 应用程序授权失败。                                 |
| 401.7                               | 访问被 Web 服务器上的 URL 授权策略拒绝。这个错误代码为 IIS 6.0 所专用。 |
| 402 Payment Required                | 此代码尚无法使用。                                           |
| 403 Forbidden                       | 对被请求页面的访问被禁止。                                   |
| 403.1                               | 执行访问被禁止。                                             |
| 403.2                               | 读访问被禁止。                                               |
| 403.3                               | 写访问被禁止。                                               |
| 403.4                               | 要求 SSL。                                                   |
| 403.5                               | 要求 SSL 128。                                               |
| 403.6                               | IP 地址被拒绝。                                              |
| 403.7                               | 要求客户端证书。                                             |
| 403.8                               | 站点访问被拒绝。                                             |
| 403.9                               | 用户数过多。                                                 |
| 403.10                              | 配置无效。                                                   |
| 403.11                              | 密码更改。                                                   |
| 403.12                              | 拒绝访问映射表。                                             |
| 403.13                              | 客户端证书被吊销。                                           |
| 403.14                              | 拒绝目录列表。                                               |
| 403.15                              | 超出客户端访问许可。                                         |
| 403.16                              | 客户端证书不受信任或无效。                                   |
| 403.17                              | 客户端证书已过期或尚未生效。                                 |
| 403.18                              | 在当前的应用程序池中不能执行所请求的 URL。这个错误代码为 IIS 6.0 所专用。 |
| 403.19                              | 不能为这个应用程序池中的客户端执行 CGI。这个错误代码为 IIS 6.0 所专用。 |
| 403.20                              | Passport 登录失败。这个错误代码为 IIS 6.0 所专用。           |
| 404 Not Found                       | 服务器无法找到被请求的页面。                                 |
| 404.0                               | （无）–没有找到文件或目录。                                  |
| 404.1                               | 无法在所请求的端口上访问 Web 站点。                          |
| 404.2                               | Web 服务扩展锁定策略阻止本请求。                             |
| 404.3                               | MIME 映射策略阻止本请求。                                    |
| 405 Method Not Allowed              | 请求中指定的方法不被允许。                                   |
| 406 Not Acceptable                  | 服务器生成的响应无法被客户端所接受。                         |
| 407 Proxy Authentication Required   | 用户必须首先使用代理服务器进行验证，这样请求才会被处理。     |
| 408 Request Timeout                 | 请求超出了服务器的等待时间。                                 |
| 409 Conflict                        | 由于冲突，请求无法被完成。                                   |
| 410 Gone                            | 被请求的页面不可用。                                         |
| 411 Length Required                 | "Content-Length" 未被定义。如果无此内容，服务器不会接受请求。 |
| 412 Precondition Failed             | 请求中的前提条件被服务器评估为失败。                         |
| 413 Request Entity Too Large        | 由于所请求的实体的太大，服务器不会接受请求。                 |
| 414 Request-url Too Long            | 由于url太长，服务器不会接受请求。当post请求被转换为带有很长的查询信息的get请求时，就会发生这种情况。 |
| 415 Unsupported Media Type          | 由于媒介类型不被支持，服务器不会接受请求。                   |
| 416 Requested Range Not Satisfiable | 服务器不能满足客户在请求中指定的Range头。                    |
| 417 Expectation Failed              | 执行失败。                                                   |
| 423                                 | 锁定的错误。                                                 |

| 消息                           | 描述                                                  |
| ------------------------------ | ----------------------------------------------------- |
| 500 Internal Server Error      | 请求未完成。服务器遇到不可预知的情况。                |
| 500.12                         | 应用程序正忙于在 Web 服务器上重新启动。               |
| 500.13                         | Web 服务器太忙。                                      |
| 500.15                         | 不允许直接请求 Global.asa。                           |
| 500.16                         | UNC 授权凭据不正确。这个错误代码为 IIS 6.0 所专用。   |
| 500.18                         | URL 授权存储不能打开。这个错误代码为 IIS 6.0 所专用。 |
| 500.100                        | 内部 ASP 错误。                                       |
| 501 Not Implemented            | 请求未完成。服务器不支持所请求的功能。                |
| 502 Bad Gateway                | 请求未完成。服务器从上游服务器收到一个无效的响应。    |
| 502.1                          | CGI 应用程序超时。　·                                 |
| 502.2                          | CGI 应用程序出错。                                    |
| 503 Service Unavailable        | 请求未完成。服务器临时过载或宕机。                    |
| 504 Gateway Timeout            | 网关超时。                                            |
| 505 HTTP Version Not Supported | 服务器不支持请求中指明的HTTP协议版本。                |

# 八、特点

1. 支持客户端/服务器模式

   HTTP工作于客户端服务端的架构之上，浏览器作为客户端通过url向服务器及web服务器发送请求，web服务器根据接收到的请求向客户端发送响应信息。

2. 简单快速

   客户端向服务器请求时，只需传送请求方法和路径，请求方法有post、get等，每种方法规定了客户端与服务端
   连接的类型不同。由于HTTP协议简单，使得HTTP服务程序规模小而且通信速度很快。

3. 灵活

   HTTP允许传输任意类型的数据对象。

4. 无连接

   限制每次连接只能处理一个请求，服务器处理完客户端的请求并收到客户端的应答后即断开连接，

   采用这种方式可以节省时间。HTTP1.1后默认采用keepline长连接，服务器要等一段时间后才能断开连接，

   以保证连接特性。但是你始终都要认为HTTP请求在结束后连接就会关闭，这是HTTP的特性。

   与下层实现在结束后是否关闭连接都不会改变这个特性，长连接可以理解为下层实现对上层透明。

5. 无状态

   无状态是指协议对事务处理没有记忆能力，意味着如果后续处理需要前面的信息，则必须被重传，

   这可能导致每次连接的数据量增大，另一方面不需要前面信息时，它的应答就较快。